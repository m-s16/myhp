<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyPortfolio ゲーム作品紹介</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div id="mainvisual" style="height: 10vh; margin-bottom: 20px;">
        <header id="header">
            <h1>マイポートフォリオ</h1>
            <nav>
                <ul>
                    <li><a href="../index.html">toTop</a></li>
                    
                </ul>
            </nav>
        </header>
        
    </div>

    <main>
        <section id = "works_detail">
            <h2>2D横スクロールアクション</h2>

            <div id="unity-container" class="unity-desktop">
                <canvas id="unity-canvas" width=960 height=600 tabindex="-1"></canvas>
                <div id="unity-loading-bar">
                  <div id="unity-logo"></div>
                  <div id="unity-progress-bar-empty">
                    <div id="unity-progress-bar-full"></div>
                  </div>
                </div>
                <div id="unity-warning"> </div>
                <div id="unity-footer">
                  <div id="unity-webgl-logo"></div>
                  <div id="unity-fullscreen-button"></div>
                  <div id="unity-build-title">Jewelry Hunter 20240411</div>
                </div>
              </div>
              <script>
          
                var container = document.querySelector("#unity-container");
                var canvas = document.querySelector("#unity-canvas");
                var loadingBar = document.querySelector("#unity-loading-bar");
                var progressBarFull = document.querySelector("#unity-progress-bar-full");
                var fullscreenButton = document.querySelector("#unity-fullscreen-button");
                var warningBanner = document.querySelector("#unity-warning");
          
                // Shows a temporary message banner/ribbon for a few seconds, or
                // a permanent error message on top of the canvas if type=='error'.
                // If type=='warning', a yellow highlight color is used.
                // Modify or remove this function to customize the visually presented
                // way that non-critical warnings and error messages are presented to the
                // user.
                function unityShowBanner(msg, type) {
                  function updateBannerVisibility() {
                    warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
                  }
                  var div = document.createElement('div');
                  div.innerHTML = msg;
                  warningBanner.appendChild(div);
                  if (type == 'error') div.style = 'background: red; padding: 10px;';
                  else {
                    if (type == 'warning') div.style = 'background: yellow; padding: 10px;';
                    setTimeout(function() {
                      warningBanner.removeChild(div);
                      updateBannerVisibility();
                    }, 5000);
                  }
                  updateBannerVisibility();
                }
          
                var buildUrl = "Build";
                var loaderUrl = buildUrl + "/jewelryhunter20240430test2.loader.js";
                var config = {
                  dataUrl: buildUrl + "/jewelryhunter20240430test2.data",
                  frameworkUrl: buildUrl + "/jewelryhunter20240430test2.framework.js",
                  codeUrl: buildUrl + "/jewelryhunter20240430test2.wasm",
                  streamingAssetsUrl: "StreamingAssets",
                  companyName: "DefaultCompany",
                  productName: "Jewelry Hunter 20240411",
                  productVersion: "1.0",
                  showBanner: unityShowBanner,
                };
          
                // By default, Unity keeps WebGL canvas render target size matched with
                // the DOM size of the canvas element (scaled by window.devicePixelRatio)
                // Set this to false if you want to decouple this synchronization from
                // happening inside the engine, and you would instead like to size up
                // the canvas DOM size and WebGL render target sizes yourself.
                // config.matchWebGLToCanvasSize = false;
          
                if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                  // Mobile device style: fill the whole browser client area with the game canvas:
          
                  var meta = document.createElement('meta');
                  meta.name = 'viewport';
                  meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
                  document.getElementsByTagName('head')[0].appendChild(meta);
                  container.className = "unity-mobile";
                  canvas.className = "unity-mobile";
          
                  // To lower canvas resolution on mobile devices to gain some
                  // performance, uncomment the following line:
                  // config.devicePixelRatio = 1;
          
          
                } else {
                  // Desktop style: Render the game canvas in a window that can be maximized to fullscreen:
          
                  canvas.style.width = "960px";
                  canvas.style.height = "600px";
                }
          
                loadingBar.style.display = "block";
          
                var script = document.createElement("script");
                script.src = loaderUrl;
                script.onload = () => {
                  createUnityInstance(canvas, config, (progress) => {
                    progressBarFull.style.width = 100 * progress + "%";
                        }).then((unityInstance) => {
                          loadingBar.style.display = "none";
                          fullscreenButton.onclick = () => {
                            unityInstance.SetFullscreen(1);
                          };
                        }).catch((message) => {
                          alert(message);
                        });
                      };
          
                document.body.appendChild(script);
          
              </script>

              <p>ゲームの説明</p>
              うまくいった点、反省点、課題、エピソード

              <a href="jewelryhunter202404030test2.unitypackage"
              download="jewelryhunter202404030test2.unitypackage">ダウンロードはコチラ
            </a>
            <p>コードの説明、うまくいった点、反省点、課題、エピソード、評価してもらって直したなど、ビルドできてもweb上で動かない、以下の方法で解決これは、立ち上げたWebサーバーがBrotliという圧縮形式での送信にうまく対応できていないためのようです。

                このような場合は、以下のPlayer Settings→WebGLタブ→Publishing Settings→Compression Formatの項目をGzipもしくはDisabledにすると解消できます。

            </p>
            <pre class="code_text">

                using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PlayerController : MonoBehaviour
{

    Rigidbody2D rbody;
    float axisH = 0.0f;
    public float speed = 3.0f;
    public float jump = 9.0f;
    public LayerMask groundLayer;
    bool goJump = false;

    Animator animator;
    public string stopAnime = "PlayerStop";
    public string moveAnime = "PlayerMove";
    public string jumpAnime = "PlayerJump";
    public string goalAnime = "PlayerGoal";
    public string deadAnime = "PlayerOver";
    string nowAnime = "";
    string oldAnime = "";

    public static string gameState = "playing";

    public int score = 0;

    bool isMoving = false;

    // Start is called before the first frame update
    void Start()
    {
        rbody = this.GetComponent<Rigidbody2D>();

        animator = GetComponent<Animator>();
        nowAnime = stopAnime;
        oldAnime = stopAnime;

        gameState = "playing";
    }

    // Update is called once per frame
    void Update()
    {
        if (gameState != "playing")
        {
            return;
        }

        if(isMoving == false)
        {
            axisH = Input.GetAxisRaw("Horizontal");
        }

        //axisH = Input.GetAxisRaw("Horizontal");
        if (axisH > 0.0f)
        {
            Debug.Log("右移動");
            transform.localScale = new Vector2(1, 1);
        }
        else if (axisH &lt; 0.0f)
        {
            Debug.Log("左移動");
            transform.localScale = new Vector2(-1, 1);

        }

        if (Input.GetButtonDown("Jump"))
        {
            Jump();
        }

        
    }

    void FixedUpdate()
    {
        if (gameState != "playing")
        {
            return;
        }


        bool onGround = Physics2D.CircleCast(transform.position,
            0.2f,
            Vector2.down,
            0.0f,
            groundLayer);
        if (onGround || axisH != 0)
        {
            rbody.velocity = new Vector2(speed * axisH * 3.0f, rbody.velocity.y);

        }

        if (onGround && goJump)
        {

            Vector2 jumpPw = new Vector2(0, jump);
            rbody.AddForce(jumpPw, ForceMode2D.Impulse);
            goJump = false;
        }

        if (onGround)
        {
            if (axisH == 0)
            {
                nowAnime = stopAnime;
            }
            else
            {
                nowAnime = moveAnime;
            }
        }

        else
        {
            nowAnime = jumpAnime;
        }

        if ( nowAnime != oldAnime)
        {
            oldAnime = nowAnime;
            animator.Play(nowAnime);
        }

        
    }
    public void Jump()
    {
        goJump = true;
    }

    void OnTriggerEnter2D(Collider2D collision)
    {
        if (collision.gameObject.tag == "Goal")
        {
            Goal();
        }

        else if (collision.gameObject.tag == "Dead")
        {
            GameOver();
        }
        else if (collision.gameObject.tag == "ScoreItem")
        {
            ItemData item = collision.gameObject.GetComponent<ItemData>();
            score = item.value;

            Destroy(collision.gameObject);
        }
    }

    public void Goal()
    {
        animator.Play(goalAnime);

        gameState = "gameclear";
        GameStop();
    }

    public void GameOver() 
    { 
        animator.Play(deadAnime);

        gameState = "gameover";
        GameStop();

        GetComponent<CapsuleCollider2D>().enabled = false;

        rbody.AddForce(new Vector2(0,5), ForceMode2D.Impulse);
    }

    void GameStop()
    {
        Rigidbody2D rbody = GetComponent<Rigidbody2D>();
        rbody.velocity =new Vector2(0,0);
    }

    public void SetAxis(float h, float v)
    {
        axisH = h;
        if (axisH == 0)
        {
            isMoving = false;
        }
        else
        {
            isMoving = true;
        }
    }
}

            </pre>
        </section>
    </main>
</body>
</html>
